å¥½çš„ï¼Œæ²¡é—®é¢˜ï¼æˆ‘å°½é‡ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ç»™ä½ è§£é‡Š Python ä¸­çš„ Dijkstra ç®—æ³•ã€‚

**1. ä»€ä¹ˆæ˜¯ Dijkstra ç®—æ³•ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ä½ æœ‰ä¸€ä¸ªåœ°å›¾ï¼Œä¸Šé¢æœ‰å¾ˆå¤šåŸå¸‚å’Œè¿æ¥è¿™äº›åŸå¸‚çš„é“è·¯ï¼Œæ¯æ¡é“è·¯éƒ½æœ‰ä¸€ä¸ªé•¿åº¦ï¼ˆä¾‹å¦‚è·ç¦»ï¼‰ã€‚Dijkstra ç®—æ³•å°±åƒæ˜¯åœ¨è¿™
ä¸ªåœ°å›¾ä¸Šæ‰¾åˆ°ä»ä½ çš„èµ·ç‚¹åˆ°å…¶ä»–æ‰€æœ‰åŸå¸‚çš„æœ€çŸ­è·¯å¾„ã€‚

æ›´å…·ä½“åœ°è¯´ï¼š

*   **ç›®æ ‡:**  ç»™å®šä¸€ä¸ªå›¾å’Œä¸€ä¸ªèµ·å§‹èŠ‚ç‚¹ï¼Œæ‰¾å‡ºä»èµ·å§‹èŠ‚ç‚¹åˆ°å›¾ä¸­æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚
*   **é€‚ç”¨æƒ…å†µ:**  é€šå¸¸ç”¨äºè§£å†³éè´Ÿæƒå›¾ï¼ˆä¹Ÿå°±æ˜¯é“è·¯é•¿åº¦éƒ½æ˜¯æ­£æ•°æˆ–è€…é›¶ï¼‰çš„å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ã€‚

**2. ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³**

Dijkstra ç®—æ³•é‡‡ç”¨ä¸€ç§è´ªå¿ƒç­–ç•¥ï¼š

1.  **åˆå§‹åŒ–:**
    *   ç»™èµ·å§‹èŠ‚ç‚¹è®¾ç½®è·ç¦»ä¸º 0ï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„è·ç¦»éƒ½è®¾ç½®ä¸ºæ— ç©·å¤§ï¼ˆè¡¨ç¤ºç›®å‰è¿˜æ²¡æ‰¾åˆ°åˆ°è¾¾è¿™äº›èŠ‚ç‚¹çš„è·¯å¾„ï¼‰ã€‚
    *   åˆ›å»ºä¸€ä¸ªé›†åˆ `visited` (æˆ–è€…ä¸€ä¸ªæ ‡è®°æ•°ç»„) ç”¨äºè®°å½•å·²ç»æ‰¾åˆ°æœ€çŸ­è·¯å¾„çš„èŠ‚ç‚¹ã€‚
2.  **å¾ªç¯:**
    *   ä»å›¾ä¸­é€‰æ‹©å½“å‰æœªè®¿é—®ä¸”è·ç¦»æœ€å°çš„èŠ‚ç‚¹ `u`ã€‚
    *   å°† `u` æ ‡è®°ä¸ºå·²è®¿é—® (`visited`)ã€‚
    *   å¯¹äºä¸ `u` ç›¸é‚»çš„æ‰€æœ‰èŠ‚ç‚¹ `v`:
        *   è®¡ç®—ä»èµ·å§‹èŠ‚ç‚¹ç»è¿‡ `u` åˆ° `v` çš„è·¯å¾„é•¿åº¦ã€‚
        *   å¦‚æœè¿™ä¸ªæ–°çš„è·¯å¾„é•¿åº¦æ¯”ç›®å‰ `v` å·²çŸ¥çš„è·ç¦»çŸ­ï¼Œå°±æ›´æ–° `v` çš„è·ç¦»å’Œå‰é©±èŠ‚ç‚¹ï¼ˆè®°å½•æ˜¯ä»å“ªä¸ªèŠ‚ç‚¹åˆ°è¾¾ `v` çš„ï¼‰ã€‚

3.  **é‡å¤:** é‡å¤æ­¥éª¤ 2ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®è¿‡æˆ–è€…æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚

**3. Python ä»£ç ç¤ºä¾‹**

```python
import heapq  # ç”¨äºåˆ›å»ºä¼˜å…ˆé˜Ÿåˆ—

def dijkstra(graph, start):
    distances = {node: float('inf') for node in graph} # åˆå§‹åŒ–è·ç¦»ä¸ºæ— ç©·å¤§
    distances[start] = 0 # èµ·å§‹èŠ‚ç‚¹è·ç¦»ä¸º0
    pq = [(0, start)] # åˆ›å»ºä¼˜å…ˆé˜Ÿåˆ—ï¼Œå…ƒç´ æ˜¯ (è·ç¦», èŠ‚ç‚¹)

    while pq:
        dist, u = heapq.heappop(pq) # å–å‡ºå½“å‰æœ€å°è·ç¦»çš„èŠ‚ç‚¹

        if dist > distances[u]: # å¦‚æœå·²ç»æ‰¾åˆ°æ›´çŸ­è·¯å¾„ï¼Œåˆ™è·³è¿‡
            continue

        for v, weight in graph[u].items(): # éå†ä¸ u ç›¸é‚»çš„èŠ‚ç‚¹
            new_dist = dist + weight
            if new_dist < distances[v]: # å¦‚æœæ‰¾åˆ°æ›´çŸ­è·¯å¾„
                distances[v] = new_dist # æ›´æ–°è·ç¦»
                heapq.heappush(pq, (new_dist, v)) # å°† v åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—

    return distances

# ç¤ºä¾‹å›¾ï¼ˆç”¨å­—å…¸è¡¨ç¤ºï¼‰
graph = {
    'A': {'B': 5, 'C': 1},
    'B': {'A': 5, 'C': 2, 'D': 1},
    'C': {'A': 1, 'B': 2, 'D': 4, 'E': 8},
    'D': {'B': 1, 'C': 4, 'E': 3},
    'E': {'C': 8, 'D': 3}
}

start_node = 'A'
shortest_distances = dijkstra(graph, start_node)

print(f"ä»èŠ‚ç‚¹ {start_node} åˆ°å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·ç¦»:")
for node, dist in shortest_distances.items():
    print(f"{node}: {dist}")
```

**ä»£ç è§£é‡Šï¼š**

* `graph`:  ç”¨å­—å…¸è¡¨ç¤ºå›¾ã€‚é”®æ˜¯èŠ‚ç‚¹åç§°ï¼Œå€¼æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­åŒ…å«ç›¸é‚»èŠ‚ç‚¹åŠå…¶è¿æ¥çš„æƒé‡ï¼ˆé“è·¯é•¿åº¦ï¼‰ã€‚

* `distances`:  å­˜å‚¨ä»èµ·å§‹èŠ‚ç‚¹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚

* `pq`: ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä½¿ç”¨ `heapq` å®ç°ã€‚å®ƒç¡®ä¿æˆ‘ä»¬æ€»æ˜¯é€‰æ‹©å½“å‰æœªè®¿é—®ä¸”è·ç¦»æœ€å°çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚å †ä¸­çš„å…ƒç´ æ˜¯å…ƒç»„`(è·ç¦»
  ,èŠ‚ç‚¹)`ï¼Œä¿è¯æ¯æ¬¡å–å‡ºçš„éƒ½æ˜¯è·ç¦»æœ€å°çš„èŠ‚ç‚¹ã€‚

* å¾ªç¯ï¼šä¸æ–­ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–å‡ºè·ç¦»æœ€å°çš„èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°å…¶ç›¸é‚»èŠ‚ç‚¹çš„è·ç¦»ã€‚

  #### ä¿®æ”¹ Dijkstra å‡½æ•°ä»¥æ”¯æŒ `defaultdict`

  ```python
  def dijkstra(graph, start):
      # åˆå§‹åŒ–è·ç¦»å­—å…¸
      distances = defaultdict(lambda: float('inf'))
      distances[start] = 0  # èµ·ç‚¹è·ç¦»ä¸º0
  
      # ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰
      pq = [(0, start)]
  
      while pq:
          dist_u, u = heapq.heappop(pq)
  
          # å¦‚æœå½“å‰è·ç¦»å¤§äºå·²è®°å½•çš„è·ç¦»ï¼Œè·³è¿‡
          if dist_u > distances[u]:
              continue
  
          # éå† u çš„æ‰€æœ‰é‚»å±…
          for v, weight in graph[u].items():
              new_dist = dist_u + weight
              if new_dist < distances[v]:
                  distances[v] = new_dist
                  heapq.heappush(pq, (new_dist, v))
  
      return distances
  ```

**4. è¿è¡Œç»“æœç¤ºä¾‹ï¼š**

```
ä»èŠ‚ç‚¹ A åˆ°å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·ç¦»:
A: 0
B: 3
C: 1
D: 4
E: 7
```

è¿™è¡¨ç¤ºä»èŠ‚ç‚¹ 'A' å‡ºå‘ï¼Œåˆ°è¾¾èŠ‚ç‚¹ 'B' çš„æœ€çŸ­è·ç¦»æ˜¯ 3ï¼Œåˆ°è¾¾èŠ‚ç‚¹ 'C' çš„æœ€çŸ­è·ç¦»æ˜¯ 1ï¼Œä¾æ­¤ç±»æ¨ã€‚

**5.  é‡è¦æ¦‚å¿µï¼š**

*   **ä¼˜å…ˆé˜Ÿåˆ—:** Dijkstraç®—æ³•çš„æ ¸å¿ƒæ•ˆç‡åœ¨äºä½¿ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå®ƒèƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°å½“å‰æœªè®¿é—®ä¸”è·ç¦»æœ€å°çš„èŠ‚ç‚¹ã€‚
*   **è´ªå¿ƒç­–ç•¥:** æ¯æ¬¡é€‰æ‹©å½“å‰æœ€ä½³çš„èŠ‚ç‚¹è¿›è¡Œæ‰©å±•ï¼Œæœ€ç»ˆä¿è¯æ‰¾åˆ°å…¨å±€æœ€çŸ­è·¯å¾„ã€‚ï¼ˆå‰ææ˜¯å›¾ä¸­çš„æƒé‡æ˜¯éè´Ÿæ•°ï¼‰ã€‚
*   **éè´Ÿæƒå›¾:** Dijkstraç®—æ³•è¦æ±‚å›¾ä¸­æ‰€æœ‰è¾¹çš„æƒé‡éƒ½å¿…é¡»æ˜¯éè´Ÿçš„ï¼ˆæ­£æ•°æˆ–é›¶ï¼‰ï¼Œå¦åˆ™å¯èƒ½æ— æ³•å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚

**æ€»ç»“ï¼š**

Dijkstra ç®—æ³•æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥è§£å†³è®¸å¤šå®é™…é—®é¢˜ï¼Œä¾‹å¦‚ç½‘ç»œè·¯ç”±ã€åœ°å›¾å¯¼èˆªç­‰ã€‚ç†è§£å…¶æ ¸å¿ƒæ€æƒ³å’Œå®ç°æ–¹å¼å¯¹äºå­¦ä¹ å›¾è®º
å’Œç®—æ³•éå¸¸æœ‰å¸®åŠ©ã€‚ å¦‚æœä½ è¿˜æœ‰ä»€ä¹ˆç–‘é—®ï¼Œéšæ—¶é—®æˆ‘ï¼



å¥½çš„ï¼æˆ‘ä»¬ä»¥è¿™é“é¢˜ä¸ºä¾‹ï¼Œé€æ­¥è®²è§£å¦‚ä½•å°†**åŸºç¡€Dijkstraç®—æ³•**æ‰©å±•ä¸º**å¤šçº¦æŸæ¡ä»¶ä¸‹çš„Dijkstraç®—æ³•**ï¼Œå¹¶ç†è§£å…¶æ ¸å¿ƒæ€æƒ³å’Œå®ç°æ–¹å¼ã€‚

------

###### ğŸŒŸ é—®é¢˜å›é¡¾

æˆ‘ä»¬éœ€è¦åœ¨æ»¡è¶³**é€šè¡Œè´¹ä¸è¶…è¿‡K**çš„å‰æä¸‹ï¼Œæ‰¾åˆ°ä»åŸå¸‚1åˆ°åŸå¸‚Nçš„**æœ€çŸ­è·¯å¾„é•¿åº¦**ã€‚æ¯æ¡é“è·¯æœ‰ä¸¤ä¸ªå±æ€§ï¼š

- **é•¿åº¦L**ï¼šè·¯å¾„çš„ç‰©ç†è·ç¦»ã€‚
- **é€šè¡Œè´¹T**ï¼šé€šè¿‡è¿™æ¡è·¯éœ€è¦æ”¯ä»˜çš„é‡‘å¸æ•°ã€‚

------

###### ğŸ§  åŸºç¡€Dijkstraçš„å±€é™æ€§

åŸºç¡€Dijkstraç®—æ³•åªèƒ½å¤„ç†**å•ä¸€ç»´åº¦çš„æœ€çŸ­è·¯å¾„é—®é¢˜**ï¼ˆä¾‹å¦‚åªè€ƒè™‘è·¯å¾„é•¿åº¦ï¼‰ã€‚ä½†åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶è€ƒè™‘ï¼š

1. **è·¯å¾„æ€»é•¿åº¦æœ€å°**ï¼ˆç›®æ ‡ï¼‰ã€‚
2. **è·¯å¾„æ€»é€šè¡Œè´¹ä¸è¶…è¿‡K**ï¼ˆçº¦æŸï¼‰ã€‚

å› æ­¤ï¼ŒåŸºç¡€Dijkstraæ— æ³•ç›´æ¥å¤„ç†è¿™ç§**å¤šçº¦æŸæ¡ä»¶**çš„é—®é¢˜ã€‚

------

###### ğŸ” æ ¸å¿ƒæ€æƒ³ï¼šçŠ¶æ€æ‰©å±•

ä¸ºäº†è§£å†³å¤šçº¦æŸé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥**çŠ¶æ€æ‰©å±•**çš„æ€æƒ³ã€‚å°†åŸæœ¬çš„â€œåŸå¸‚â€çŠ¶æ€æ‰©å±•ä¸ºâ€œåŸå¸‚ + å½“å‰å·²èŠ±è´¹çš„é€šè¡Œè´¹â€ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„çŠ¶æ€ç©ºé—´ã€‚

#### æ–°çš„çŠ¶æ€å®šä¹‰

- çŠ¶æ€

  ```
  (u, c)
  ```

  è¡¨ç¤ºï¼š

  - å½“å‰åœ¨åŸå¸‚ `u`ã€‚
  - å·²èŠ±è´¹çš„é€šè¡Œè´¹ä¸º `c`ï¼ˆ`0 â‰¤ c â‰¤ K`ï¼‰ã€‚

- ç›®æ ‡ï¼šåœ¨æ‰€æœ‰æ»¡è¶³ `c â‰¤ K` çš„çŠ¶æ€ä¸‹ï¼Œæ‰¾åˆ°ä» `(1, 0)` åˆ° `(N, c)` çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚

#### çŠ¶æ€è½¬ç§»

å¯¹äºæ¯æ¡è¾¹ `(u â†’ v, L, T)`ï¼Œæˆ‘ä»¬å°è¯•ä»çŠ¶æ€ `(u, c)` è½¬ç§»åˆ° `(v, c + T)`ï¼š

- å¦‚æœ `c + T > K`ï¼Œåˆ™è·³è¿‡ï¼ˆè¿åçº¦æŸï¼‰ã€‚
- å¦åˆ™ï¼Œè®¡ç®—æ–°çš„è·¯å¾„é•¿åº¦ `d + L`ï¼Œå¹¶æ›´æ–°çŠ¶æ€ `(v, c + T)` çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚

------

###### ğŸ§® å®ç°æ­¥éª¤è¯¦è§£

#### 1. æ•°æ®ç»“æ„

- **é‚»æ¥è¡¨**ï¼šå­˜å‚¨æ¯ä¸ªåŸå¸‚çš„æ‰€æœ‰å‡ºè¾¹ï¼ˆç»ˆç‚¹ã€é•¿åº¦ã€é€šè¡Œè´¹ï¼‰ã€‚

- è·ç¦»æ•°ç»„ï¼š

  ```
  dist[u][c]
  ```

  è¡¨ç¤ºåˆ°è¾¾åŸå¸‚

  ```
  u
  ```

  å¹¶èŠ±è´¹

  ```
  c
  ```

  é‡‘å¸çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚

  - åˆå§‹åŒ–ï¼š`dist[1][0] = 0`ï¼Œå…¶ä½™ä¸ºæ— ç©·å¤§ã€‚

- **ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰**ï¼šæŒ‰ `(å½“å‰è·¯å¾„é•¿åº¦, å½“å‰åŸå¸‚, å½“å‰é€šè¡Œè´¹)` æ’åºï¼Œæ¯æ¬¡å–æœ€å°è·¯å¾„é•¿åº¦çš„çŠ¶æ€ã€‚

#### 2. ç®—æ³•æµç¨‹

1. **åˆå§‹åŒ–**ï¼š

   - `dist[1][0] = 0`ã€‚
   - å°†åˆå§‹çŠ¶æ€ `(0, 1, 0)` åŠ å…¥å †ï¼ˆå †é¡¶æ˜¯è·¯å¾„é•¿åº¦æœ€å°çš„çŠ¶æ€ï¼‰ã€‚

2. **Dijkstraä¸»å¾ªç¯**ï¼š

   - å–å‡ºå †é¡¶çŠ¶æ€ `(d, u, c)`ã€‚

   - å¦‚æœ `d > dist[u][c]`ï¼Œè¯´æ˜è¯¥çŠ¶æ€å·²è¢«æ›´ä¼˜è·¯å¾„è¦†ç›–ï¼Œè·³è¿‡ã€‚

   - éå†æ‰€æœ‰ä»

     ```
     u
     ```

     å‡ºå‘çš„è¾¹

     ```
     (v, L, T)
     ```

     - æ–°é€šè¡Œè´¹ `new_c = c + T`ã€‚
     - å¦‚æœ `new_c > K`ï¼Œè·³è¿‡ã€‚
     - æ–°è·¯å¾„é•¿åº¦ `new_d = d + L`ã€‚
     - å¦‚æœ `new_d < dist[v][new_c]`ï¼Œæ›´æ–° `dist[v][new_c]` å¹¶å°†æ–°çŠ¶æ€ `(new_d, v, new_c)` åŠ å…¥å †ã€‚

3. **æœ€ç»ˆç»“æœ**ï¼š

   - éå†æ‰€æœ‰ `dist[N][c]`ï¼ˆ`0 â‰¤ c â‰¤ K`ï¼‰ï¼Œå–æœ€å°å€¼ä½œä¸ºç­”æ¡ˆã€‚
   - å¦‚æœæœ€å°å€¼ä»ä¸ºæ— ç©·å¤§ï¼Œè¯´æ˜æ— è§£ï¼Œè¿”å› `-1`ã€‚

------

###### ğŸ“Œ ä»£ç ç¤ºä¾‹è§£æ

ä»¥ä¸‹æ˜¯é’ˆå¯¹æœ¬é¢˜çš„Pythonå®ç°ä»£ç ï¼š

```python
import heapq

def main():
    K = int(input())  # æœ€å¤§é€šè¡Œè´¹
    N = int(input())  # åŸå¸‚æ•°é‡
    R = int(input())  # é“è·¯æ•°é‡

    # æ„å»ºé‚»æ¥è¡¨
    adj = [[] for _ in range(N + 1)]
    for _ in range(R):
        S, D, L, T = map(int, input().split())
        adj[S].append((D, L, T))  # (ç»ˆç‚¹, é•¿åº¦, é€šè¡Œè´¹)

    INF = 10**18  # è¡¨ç¤ºæ— ç©·å¤§
    # dist[u][c] è¡¨ç¤ºåˆ°åŸå¸‚uèŠ±è´¹cé‡‘å¸çš„æœ€çŸ­è·¯å¾„é•¿åº¦
    dist = [[INF] * (K + 1) for _ in range(N + 1)]
    dist[1][0] = 0  # åˆå§‹çŠ¶æ€ï¼šä»åŸå¸‚1å‡ºå‘ï¼ŒèŠ±è´¹0é‡‘å¸

    # ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå­˜å‚¨ (å½“å‰è·¯å¾„é•¿åº¦, å½“å‰åŸå¸‚, å½“å‰é€šè¡Œè´¹)
    heap = []
    heapq.heappush(heap, (0, 1, 0))

    while heap:
        d, u, c = heapq.heappop(heap)
        if d > dist[u][c]:
            continue  # å¦‚æœå½“å‰çŠ¶æ€ä¸æ˜¯æœ€ä¼˜è§£ï¼Œè·³è¿‡
        for v, l, t in adj[u]:
            new_c = c + t
            if new_c > K:
                continue  # è¶…è¿‡é€šè¡Œè´¹ä¸Šé™ï¼Œè·³è¿‡
            new_d = d + l
            if new_d < dist[v][new_c]:
                dist[v][new_c] = new_d  # æ›´æ–°æ›´çŸ­è·¯å¾„
                heapq.heappush(heap, (new_d, v, new_c))  # åŠ å…¥å †

    # æ‰¾åˆ°æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„åˆ°è¾¾Nçš„æœ€çŸ­è·¯å¾„
    res = min(dist[N][c] for c in range(K + 1))
    print(-1 if res == INF else res)

if __name__ == "__main__":
    main()
```

------

###### ğŸ§© å…³é”®ç‚¹æ€»ç»“

1. **çŠ¶æ€æ‰©å±•**ï¼š
   - å°†åŸé—®é¢˜çš„â€œåŸå¸‚â€çŠ¶æ€æ‰©å±•ä¸ºâ€œåŸå¸‚ + é€šè¡Œè´¹â€ï¼Œå½¢æˆäºŒç»´çŠ¶æ€ç©ºé—´ã€‚
   - æ¯ä¸ªçŠ¶æ€ `(u, c)` è¡¨ç¤ºåˆ°è¾¾åŸå¸‚ `u` å¹¶èŠ±è´¹ `c` é‡‘å¸çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚
2. **ä¼˜å…ˆé˜Ÿåˆ—çš„ä½œç”¨**ï¼š
   - ä¼˜å…ˆé˜Ÿåˆ—å§‹ç»ˆæŒ‰è·¯å¾„é•¿åº¦æ’åºï¼Œç¡®ä¿æ¯æ¬¡å¤„ç†çš„æ˜¯å½“å‰æœ€çŸ­çš„è·¯å¾„ã€‚
   - å¦‚æœæŸä¸ªçŠ¶æ€ `(u, c)` è¢«å¤šæ¬¡è®¿é—®ï¼Œåªæœ‰å½“æ–°çš„è·¯å¾„é•¿åº¦æ›´çŸ­æ—¶æ‰ä¼šæ›´æ–°ã€‚
3. **å¤æ‚åº¦åˆ†æ**ï¼š
   - çŠ¶æ€æ€»æ•°ï¼š`N * (K + 1)`ï¼ˆæœ€å¤š `100 * 10001 = 1,000,100` ä¸ªçŠ¶æ€ï¼‰ã€‚
   - æ¯æ¡è¾¹æœ€å¤šè¢«å¤„ç† `K` æ¬¡ï¼ˆæ¯æ¬¡å¯¹åº”ä¸åŒçš„é€šè¡Œè´¹çŠ¶æ€ï¼‰ã€‚
   - æ€»æ—¶é—´å¤æ‚åº¦çº¦ä¸º `O(R * K log(NK))`ï¼Œåœ¨é¢˜ç›®é™åˆ¶ä¸‹ï¼ˆ`R â‰¤ 10000, K â‰¤ 10000`ï¼‰æ˜¯å¯æ¥å—çš„ã€‚



å¥½çš„ï¼æˆ‘æ¥ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼ç»™ä½ è®²è®² **Python çš„æ‹“æ‰‘æ’åº**ï¼Œå¹¶é™„ä¸Šä»£ç ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ ä¸€æ­¥æ­¥ç†è§£ã€‚

---

### **ä»€ä¹ˆæ˜¯æ‹“æ‰‘æ’åºï¼Ÿ**

æ‹“æ‰‘æ’åºæ˜¯ä¸€ç§å¯¹ **æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰** çš„èŠ‚ç‚¹è¿›è¡Œæ’åºçš„æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

> **å°†æ‰€æœ‰èŠ‚ç‚¹æ’æˆä¸€ä¸ªçº¿æ€§åºåˆ—ï¼Œä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½å‡ºç°åœ¨å®ƒä¹‹å‰ã€‚**

ä¸¾ä¸ªä¾‹å­ï¼š  
å‡è®¾ä½ è¦åšè›‹ç³•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

1. å‡†å¤‡ææ–™ï¼ˆAï¼‰ â†’ 2. æ··åˆææ–™ï¼ˆBï¼‰ â†’ 3. çƒ˜ç„™ï¼ˆCï¼‰  
   è¿™é‡Œï¼ŒB ä¾èµ– Aï¼ŒC ä¾èµ– Bã€‚æ‹“æ‰‘æ’åºçš„ç»“æœå¯èƒ½æ˜¯ `[A, B, C]`ã€‚

---

### **ä¸ºä»€ä¹ˆéœ€è¦æ‹“æ‰‘æ’åºï¼Ÿ**

- **ä»»åŠ¡è°ƒåº¦**ï¼šæ¯”å¦‚è¯¾ç¨‹å®‰æ’ï¼ˆå…ˆå­¦æ•°å­¦å†å­¦ç‰©ç†ï¼‰ã€è½¯ä»¶ä¾èµ–å®‰è£…ã€‚
- **ç¼–è¯‘é¡ºåº**ï¼šç¼–è¯‘å¤šä¸ªæ¨¡å—æ—¶ï¼Œå¿…é¡»å…ˆç¼–è¯‘ä¾èµ–çš„æ¨¡å—ã€‚
- **èµ„æºåˆ†é…**ï¼šåˆç†å®‰æ’èµ„æºï¼Œé¿å…æ­»é”ã€‚

---

### **å¦‚ä½•å®ç°æ‹“æ‰‘æ’åºï¼Ÿ**

#### **æ–¹æ³•ä¸€ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰**

1. **ä»ä»»æ„æœªè®¿é—®çš„èŠ‚ç‚¹å¼€å§‹**ï¼Œè¿›è¡Œ DFS éå†ã€‚
2. **éå†å®Œæ‰€æœ‰å­èŠ‚ç‚¹å**ï¼Œå°†å½“å‰èŠ‚ç‚¹åŠ å…¥ç»“æœåˆ—è¡¨ã€‚
3. **åè½¬ç»“æœåˆ—è¡¨**ï¼Œå¾—åˆ°æ‹“æ‰‘åºåˆ—ã€‚

```python
from collections import defaultdict

def topological_sort_dfs(graph):
    visited = set()  # è®°å½•å·²è®¿é—®çš„èŠ‚ç‚¹
    stack = []       # å­˜å‚¨æœ€ç»ˆçš„æ‹“æ‰‘åºåˆ—

    def dfs(node):
        if node in visited:
            return
        visited.add(node)
        for neighbor in graph[node]:
            dfs(neighbor)
        stack.append(node)  # å›æº¯æ—¶æ·»åŠ èŠ‚ç‚¹

    for node in graph:
        if node not in visited:
            dfs(node)
    return stack[::-1]  # åè½¬å¾—åˆ°æ‹“æ‰‘åºåˆ—

# ç¤ºä¾‹å›¾
graph = {
    'A': ['C', 'D'],
    'B': ['D', 'E'],
    'C': ['F'],
    'D': ['F'],
    'E': ['F'],
    'F': ['G'],
    'G': []
}

result = topological_sort_dfs(graph)
print(result)  # è¾“å‡º: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
```

---

#### **æ–¹æ³•äºŒï¼šKahn ç®—æ³•ï¼ˆåŸºäºå…¥åº¦ï¼‰**

1. **è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦ï¼ˆæœ‰å¤šå°‘è¾¹æŒ‡å‘å®ƒï¼‰**ã€‚
2. **å°†å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—**ã€‚
3. **ä¾æ¬¡å¤„ç†é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹**ï¼Œå‡å°‘å…¶é‚»å±…çš„å…¥åº¦ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹è¢«å¤„ç†ã€‚

```python
from collections import deque, defaultdict

def topological_sort_kahn(graph):
    in_degree = defaultdict(int)  # è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦
    # è®¡ç®—å…¥åº¦
    for u in graph:
        for v in graph[u]:
            in_degree[v] += 1

    queue = deque([u for u in graph if in_degree[u] == 0])  # å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹å…¥é˜Ÿ
    topo_order = []

    while queue:
        u = queue.popleft()
        topo_order.append(u)
        for v in graph[u]:
            in_degree[v] -= 1  # å‡å°‘é‚»å±…çš„å…¥åº¦
            if in_degree[v] == 0:
                queue.append(v)

    # å¦‚æœæ‹“æ‰‘åºåˆ—é•¿åº¦ä¸ç­‰äºèŠ‚ç‚¹æ•°ï¼Œè¯´æ˜å›¾ä¸­æœ‰ç¯
    if len(topo_order) != len(graph):
        return []  # å­˜åœ¨ç¯ï¼Œæ— æ³•æ’åº
    return topo_order

# ç¤ºä¾‹å›¾
graph = {
    'A': ['C', 'D'],
    'B': ['D', 'E'],
    'C': ['F'],
    'D': ['F'],
    'E': ['F'],
    'F': ['G'],
    'G': []
}

result = topological_sort_kahn(graph)
print(result)  # è¾“å‡º: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
```

---

### **ä»£ç è§£é‡Š**

1. **å›¾çš„è¡¨ç¤º**ï¼šç”¨å­—å…¸è¡¨ç¤ºé‚»æ¥è¡¨ï¼Œä¾‹å¦‚ `graph['A'] = ['C', 'D']` è¡¨ç¤ºèŠ‚ç‚¹ A æŒ‡å‘ C å’Œ Dã€‚
2. **DFS æ–¹æ³•**ï¼šé€šè¿‡é€’å½’éå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæœ€åå›æº¯æ—¶è®°å½•èŠ‚ç‚¹ã€‚
3. **Kahn æ–¹æ³•**ï¼šé€šè¿‡ç»´æŠ¤å…¥åº¦å’Œé˜Ÿåˆ—ï¼Œé€æ­¥å¤„ç†èŠ‚ç‚¹ã€‚

---

### **å¦‚ä½•æ£€æµ‹å›¾ä¸­æ˜¯å¦æœ‰ç¯ï¼Ÿ**

- **DFS**ï¼šå¦‚æœæœ€ç»ˆçš„æ‹“æ‰‘åºåˆ—é•¿åº¦ä¸ç­‰äºèŠ‚ç‚¹æ€»æ•°ï¼Œè¯´æ˜æœ‰ç¯ã€‚
- **Kahn**ï¼šå¦‚æœé˜Ÿåˆ—å¤„ç†å®Œåä»æœ‰èŠ‚ç‚¹æœªè¢«åŠ å…¥æ‹“æ‰‘åºåˆ—ï¼Œè¯´æ˜æœ‰ç¯ã€‚

---

### **åº”ç”¨åœºæ™¯**

1. **è¯¾ç¨‹å®‰æ’**ï¼š  
   è¯¾ç¨‹ A æ˜¯è¯¾ç¨‹ B çš„å…ˆä¿®è¯¾ï¼Œè¯¾ç¨‹ C æ˜¯è¯¾ç¨‹ D çš„å…ˆä¿®è¯¾ï¼Œæ‹“æ‰‘æ’åºå¯ä»¥å¸®ä½ æ‰¾åˆ°æ­£ç¡®çš„å­¦ä¹ é¡ºåºã€‚
2. **è½¯ä»¶ä¾èµ–**ï¼š  
   å®‰è£…è½¯ä»¶æ—¶ï¼Œéœ€è¦å…ˆå®‰è£…ä¾èµ–çš„åº“ï¼Œæ‹“æ‰‘æ’åºå¯ä»¥ç”Ÿæˆæ­£ç¡®çš„å®‰è£…é¡ºåºã€‚
3. **ä»»åŠ¡è°ƒåº¦**ï¼š  
   åœ¨æµæ°´çº¿ç”Ÿäº§ä¸­ï¼ŒæŸäº›ä»»åŠ¡å¿…é¡»åœ¨å…¶ä»–ä»»åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹ï¼Œæ‹“æ‰‘æ’åºå¯ä»¥ä¼˜åŒ–æ‰§è¡Œé¡ºåºã€‚

---

### **å°è´´å£«**

- **æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰** æ˜¯æ‹“æ‰‘æ’åºçš„å‰æï¼Œå¦‚æœå›¾ä¸­æœ‰ç¯ï¼ˆæ¯”å¦‚ A â†’ B â†’ Aï¼‰ï¼Œåˆ™æ— æ³•è¿›è¡Œæ‹“æ‰‘æ’åºã€‚
- **Python å†…ç½®åº“ `graphlib`** ä¹Ÿæä¾›äº†æ‹“æ‰‘æ’åºçš„å·¥å…·ï¼ˆPython 3.9+ï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

```python
from graphlib import TopologicalSorter

graph = {
    "A": {"C", "D"},
    "B": {"D", "E"},
    "C": {"F"},
    "D": {"F"},
    "E": {"F"},
    "F": {"G"},
    "G": set()
}

ts = TopologicalSorter(graph)
print(list(ts.static_order()))  # è¾“å‡º: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
```

---

å¸Œæœ›è¿™äº›å†…å®¹èƒ½å¸®ä½ ç†è§£æ‹“æ‰‘æ’åºï¼å¦‚æœæœ‰é—®é¢˜ï¼Œéšæ—¶é—®æˆ‘ ğŸ˜Š

å¥½çš„ï¼æˆ‘ä»¬æ¥ç”¨æœ€ç®€å•çš„æ–¹å¼ç†è§£ **Python ä¸­çš„æœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰**ï¼Œå¹¶ä¸”ä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯”å¦‚ `networkx`ï¼‰ã€‚æˆ‘ä¼šç”¨é€šä¿—çš„è¯­è¨€å’Œç¤ºä¾‹ä»£ç æ¥è§£é‡Šã€‚

---

### ä»€ä¹ˆæ˜¯ MSTï¼Ÿ

**MSTï¼ˆMinimum Spanning Treeï¼‰** æ˜¯å›¾è®ºä¸­çš„ä¸€ä¸ªç»å…¸é—®é¢˜ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ª **è¿æ¥æ‰€æœ‰èŠ‚ç‚¹çš„æœ€å°æˆæœ¬çš„æ ‘**ã€‚  

- **å›¾**ï¼šç”±èŠ‚ç‚¹ï¼ˆé¡¶ç‚¹ï¼‰å’Œè¾¹ç»„æˆï¼Œè¾¹æœ‰æƒé‡ï¼ˆæ¯”å¦‚è·ç¦»ã€è´¹ç”¨ï¼‰ã€‚  
- **ç”Ÿæˆæ ‘**ï¼šåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„æ— ç¯è¿é€šå›¾ã€‚  
- **æœ€å°ç”Ÿæˆæ ‘**ï¼šæ‰€æœ‰ç”Ÿæˆæ ‘ä¸­ï¼Œè¾¹çš„æƒé‡æ€»å’Œæœ€å°çš„é‚£ä¸ªã€‚

---

### ä¸¾ä¸ªä¾‹å­

å‡è®¾ä½ æœ‰ 4 ä¸ªåŸå¸‚ï¼ŒåŸå¸‚ä¹‹é—´æœ‰é“è·¯è¿æ¥ï¼Œæ¯æ¡é“è·¯éƒ½æœ‰ä¸åŒçš„å»ºè®¾æˆæœ¬ã€‚ä½ çš„ä»»åŠ¡æ˜¯ **ç”¨æœ€ä½çš„æ€»æˆæœ¬è¿æ¥æ‰€æœ‰åŸå¸‚**ï¼Œè¿™å°±æ˜¯ MST çš„é—®é¢˜ã€‚

---

### å®ç° MST çš„ä¸¤ç§å¸¸ç”¨ç®—æ³•

1. **Prim ç®—æ³•**ï¼ˆé€‚åˆç¨ å¯†å›¾ï¼‰  
2. **Kruskal ç®—æ³•**ï¼ˆé€‚åˆç¨€ç–å›¾ï¼‰  

æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹å®ƒä»¬çš„ Python å®ç°ã€‚

---

## æ–¹æ³• 1ï¼šPrim ç®—æ³•ï¼ˆåŸºäºé‚»æ¥è¡¨ï¼‰

### æ€è·¯

1. ä»ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œé€æ­¥æ‰©å±•ç”Ÿæˆæ ‘ã€‚
2. æ¯æ¬¡é€‰æ‹©è¿æ¥å·²é€‰èŠ‚ç‚¹å’Œæœªé€‰èŠ‚ç‚¹ä¸­ **æƒé‡æœ€å°çš„è¾¹**ã€‚
3. é‡å¤ç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è¿æ¥ã€‚

### Python ä»£ç 

```python
import heapq

def prim(graph, start):
    # åˆå§‹åŒ–å·²è®¿é—®èŠ‚ç‚¹é›†åˆå’Œæœ€å°ç”Ÿæˆæ ‘çš„è¾¹
    visited = set([start])
    mst_edges = []
    # ç”¨ä¼˜å…ˆé˜Ÿåˆ—å­˜å‚¨è¾¹ï¼ˆæƒé‡ï¼Œèµ·ç‚¹ï¼Œç»ˆç‚¹ï¼‰
    edges = [(weight, start, to) for to, weight in graph[start].items()]
    heapq.heapify(edges)

    while edges:
        weight, u, v = heapq.heappop(edges)
        if v not in visited:
            visited.add(v)
            mst_edges.append((u, v, weight))
            # å°†æ–°èŠ‚ç‚¹çš„æ‰€æœ‰è¾¹åŠ å…¥é˜Ÿåˆ—
            for to, weight in graph[v].items():
                if to not in visited:
                    heapq.heappush(edges, (weight, v, to))

    return mst_edges

# ç¤ºä¾‹å›¾ï¼ˆé‚»æ¥è¡¨è¡¨ç¤ºï¼‰
graph = {
    'A': {'B': 2, 'C': 3},
    'B': {'A': 2, 'C': 1, 'D': 1},
    'C': {'A': 3, 'B': 1, 'D': 4},
    'D': {'B': 1, 'C': 4}
}

# è®¡ç®—æœ€å°ç”Ÿæˆæ ‘
mst = prim(graph, 'A')
print("æœ€å°ç”Ÿæˆæ ‘çš„è¾¹ï¼š", mst)
```

### è¾“å‡ºç»“æœ

```
æœ€å°ç”Ÿæˆæ ‘çš„è¾¹ï¼š [('A', 'B', 2), ('B', 'D', 1), ('B', 'C', 1)]
```

### ä»£ç è§£é‡Š

1. **`graph`**ï¼šç”¨å­—å…¸è¡¨ç¤ºé‚»æ¥è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç›¸é‚»èŠ‚ç‚¹å’Œå¯¹åº”çš„æƒé‡ã€‚
2. **`heapq`**ï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼‰ï¼Œæ¯æ¬¡å–å‡ºæƒé‡æœ€å°çš„è¾¹ã€‚
3. **`visited`**ï¼šè®°å½•å·²è®¿é—®çš„èŠ‚ç‚¹ï¼Œé¿å…ç¯è·¯ã€‚
4. **`mst_edges`**ï¼šå­˜å‚¨æœ€ç»ˆç”Ÿæˆæ ‘çš„è¾¹ã€‚

---

## æ–¹æ³• 2ï¼šKruskal ç®—æ³•ï¼ˆåŸºäºè¾¹æ’åºï¼‰

### æ€è·¯

1. å°†æ‰€æœ‰è¾¹æŒ‰æƒé‡ä»å°åˆ°å¤§æ’åºã€‚
2. ä¾æ¬¡é€‰æ‹©æœ€å°çš„è¾¹ï¼Œå¦‚æœè¿™æ¡è¾¹ä¸ä¼šå½¢æˆç¯ï¼Œå°±åŠ å…¥ç”Ÿæˆæ ‘ã€‚
3. é‡å¤ç›´åˆ°ç”Ÿæˆæ ‘åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ã€‚

### Python ä»£ç 

```python
def find(parent, x):
    # è·¯å¾„å‹ç¼©ï¼šæ‰¾åˆ°æ ¹èŠ‚ç‚¹
    if parent[x] != x:
        parent[x] = find(parent, parent[x])
    return parent[x]

def union(parent, rank, x, y):
    # åˆå¹¶ä¸¤ä¸ªé›†åˆï¼ˆæŒ‰ç§©åˆå¹¶ï¼‰
    root_x = find(parent, x)
    root_y = find(parent, y)
    if root_x == root_y:
        return False  # å½¢æˆç¯ï¼Œä¸åˆå¹¶
    if rank[root_x] < rank[root_y]:
        parent[root_x] = root_y
    else:
        parent[root_y] = root_x
        if rank[root_x] == rank[root_y]:
            rank[root_x] += 1
    return True

def kruskal(graph):
    # å°†æ‰€æœ‰è¾¹æ’åº
    edges = []
    for u in graph:
        for v, weight in graph[u].items():
            if u < v:  # é¿å…é‡å¤æ·»åŠ è¾¹
                edges.append((weight, u, v))
    edges.sort()  # æŒ‰æƒé‡æ’åº

    parent = {node: node for node in graph}
    rank = {node: 0 for node in graph}
    mst_edges = []

    for weight, u, v in edges:
        if union(parent, rank, u, v):
            mst_edges.append((u, v, weight))

    return mst_edges

# ç¤ºä¾‹å›¾ï¼ˆé‚»æ¥è¡¨è¡¨ç¤ºï¼‰
graph = {
    'A': {'B': 2, 'C': 3},
    'B': {'A': 2, 'C': 1, 'D': 1},
    'C': {'A': 3, 'B': 1, 'D': 4},
    'D': {'B': 1, 'C': 4}
}

# è®¡ç®—æœ€å°ç”Ÿæˆæ ‘
mst = kruskal(graph)
print("æœ€å°ç”Ÿæˆæ ‘çš„è¾¹ï¼š", mst)
```

### è¾“å‡ºç»“æœ

```
æœ€å°ç”Ÿæˆæ ‘çš„è¾¹ï¼š [('B', 'D', 1), ('B', 'C', 1), ('A', 'B', 2)]
```

### ä»£ç è§£é‡Š

1. **`find` å’Œ `union`**ï¼šå¹¶æŸ¥é›†æ“ä½œï¼Œç”¨äºæ£€æµ‹ç¯ã€‚
2. **`edges`**ï¼šå°†æ‰€æœ‰è¾¹æ’åºåä¾æ¬¡å¤„ç†ã€‚
3. **`parent` å’Œ `rank`**ï¼šå¹¶æŸ¥é›†çš„æ•°æ®ç»“æ„ï¼Œç”¨äºç®¡ç†èŠ‚ç‚¹çš„é›†åˆå…³ç³»ã€‚

---

## ä¸¤ç§ç®—æ³•çš„åŒºåˆ«

| ç‰¹æ€§           | Prim ç®—æ³•                | Kruskal ç®—æ³•            |
| -------------- | ------------------------ | ----------------------- |
| **æ—¶é—´å¤æ‚åº¦** | O(E log V)ï¼ˆä½¿ç”¨å †ä¼˜åŒ–ï¼‰ | O(E log E)ï¼ˆæ’åºè¾¹ï¼‰    |
| **é€‚ç”¨åœºæ™¯**   | ç¨ å¯†å›¾ï¼ˆè¾¹å¤šï¼‰           | ç¨€ç–å›¾ï¼ˆè¾¹å°‘ï¼‰          |
| **æ•°æ®ç»“æ„**   | ä¼˜å…ˆé˜Ÿåˆ—                 | å¹¶æŸ¥é›†                  |
| **å®ç°éš¾åº¦**   | ç¨å¤æ‚ï¼ˆéœ€è¦ç»´æŠ¤å †ï¼‰     | è¾ƒç®€å•ï¼ˆæ’åº + å¹¶æŸ¥é›†ï¼‰ |

---

## æ€»ç»“

- **Prim ç®—æ³•** é€‚åˆèŠ‚ç‚¹è¾ƒå¤šã€è¾¹è¾ƒå¤šçš„å›¾ã€‚
- **Kruskal ç®—æ³•** é€‚åˆè¾¹è¾ƒå°‘çš„å›¾ï¼Œä»£ç æ›´ç›´è§‚ã€‚
- ä¸¤ç§æ–¹æ³•éƒ½èƒ½æ‰¾åˆ°æœ€å°ç”Ÿæˆæ ‘ï¼Œé€‰æ‹©å“ªç§å–å†³äºå…·ä½“é—®é¢˜ã€‚

å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜ï¼Œæˆ–è€…éœ€è¦è¿›ä¸€æ­¥è§£é‡Šï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼ ğŸ˜Š



å¥½çš„ï¼æˆ‘æ¥ç”¨ç®€å•çš„æ–¹å¼ç»™ä½ è®²è®² **Python çš„å¹¶æŸ¥é›†**ï¼Œå°½é‡ä¸ç”¨ä¸“ä¸šæœ¯è¯­ï¼Œç”¨ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥è§£é‡Š ğŸ˜Š

---

### **ä»€ä¹ˆæ˜¯å¹¶æŸ¥é›†ï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰å¾ˆå¤šå°æœ‹å‹ï¼Œä»–ä»¬ä¸€å¼€å§‹éƒ½æ˜¯**ç‹¬ç«‹çš„ä¸ªä½“**ï¼ˆæ¯”å¦‚æ¯ä¸ªäººéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„å°ç»„ï¼‰ã€‚  
æœ‰ä¸€å¤©ï¼Œä»–ä»¬å¼€å§‹äº¤æœ‹å‹ï¼Œæ…¢æ…¢ç»„æˆæ›´å¤§çš„å°ç»„ã€‚  

- **å¹¶æŸ¥é›†**å°±æ˜¯ç”¨æ¥ç®¡ç†è¿™äº›â€œå°ç»„â€çš„å·¥å…·ï¼Œå®ƒèƒ½å¿«é€Ÿå›ç­”ä¸¤ä¸ªé—®é¢˜ï¼š
  1. **ä¸¤ä¸ªäººæ˜¯å¦åœ¨åŒä¸€ä¸ªå°ç»„é‡Œï¼Ÿ**ï¼ˆæŸ¥æ‰¾æ“ä½œï¼‰
  2. **æŠŠä¸¤ä¸ªå°ç»„åˆå¹¶æˆä¸€ä¸ªå¤§ç»„ã€‚**ï¼ˆåˆå¹¶æ“ä½œï¼‰

---

### **å¹¶æŸ¥é›†çš„æ ¸å¿ƒåŠŸèƒ½**

å¹¶æŸ¥é›†æœ‰ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼Œå°±åƒâ€œæœ‹å‹åœˆç®¡ç†å‘˜â€çš„ä¸¤ç§æ“ä½œï¼š

#### **1. æŸ¥æ‰¾ï¼ˆFindï¼‰**

- **åŠŸèƒ½**ï¼šåˆ¤æ–­æŸä¸ªå°æœ‹å‹å±äºå“ªä¸ªå°ç»„ã€‚
- **ä¾‹å­**ï¼šä½ é—®å°æ˜ï¼šâ€œä½ å’Œå°çº¢æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå°ç»„çš„ï¼Ÿâ€  
  å¹¶æŸ¥é›†ä¼šå¸®ä½ æ‰¾åˆ°ç­”æ¡ˆï¼šå¦‚æœä¸¤äººçš„â€œç»„é•¿â€æ˜¯åŒä¸€ä¸ªäººï¼Œå°±è¯´æ˜ä»–ä»¬åœ¨åŒä¸€ç»„ã€‚

#### **2. åˆå¹¶ï¼ˆUnionï¼‰**

- **åŠŸèƒ½**ï¼šæŠŠä¸¤ä¸ªå°ç»„åˆå¹¶æˆä¸€ä¸ªå¤§ç»„ã€‚
- **ä¾‹å­**ï¼šå°æ˜å’Œå°çº¢å„è‡ªå¸¦äº†ä¸€ä¸ªå°ç»„ï¼Œç°åœ¨ä»–ä»¬å†³å®šåˆå¹¶ä¸¤ä¸ªå°ç»„ã€‚  
  å¹¶æŸ¥é›†ä¼šæŠŠå…¶ä¸­ä¸€ä¸ªå°ç»„çš„â€œç»„é•¿â€å˜æˆå¦ä¸€ä¸ªå°ç»„çš„â€œç»„é•¿â€ã€‚

---

### **å¹¶æŸ¥é›†çš„ä¼˜åŒ–æŠ€å·§**

ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç§‘å­¦å®¶ä»¬å‘æ˜äº†ä¸¤ä¸ªâ€œèªæ˜â€çš„æ–¹æ³•ï¼š

#### **è·¯å¾„å‹ç¼©ï¼ˆPath Compressionï¼‰**

- **åŸç†**ï¼šæ¯æ¬¡æŸ¥æ‰¾æ—¶ï¼Œè®©æ‰€æœ‰å°æœ‹å‹ç›´æ¥è®°ä½â€œæœ€ç»ˆçš„ç»„é•¿â€ï¼Œé¿å…ä¸‹æ¬¡å†ç»•è·¯ã€‚
- **ä¾‹å­**ï¼šå°æ˜é—®ç»„é•¿æ˜¯è°ï¼Œå‘ç°ç»„é•¿æ˜¯å°çº¢ï¼Œè€Œå°çº¢çš„ç»„é•¿æ˜¯è€å¸ˆã€‚  
  å¹¶æŸ¥é›†ä¼šç›´æ¥è®©å°æ˜è®°ä½â€œè€å¸ˆâ€æ˜¯ç»„é•¿ï¼Œçœå»ä¸‹æ¬¡æŸ¥æ‰¾çš„éº»çƒ¦ã€‚

#### **æŒ‰ç§©åˆå¹¶ï¼ˆUnion by Rankï¼‰**

- **åŸç†**ï¼šåˆå¹¶å°ç»„æ—¶ï¼Œæ€»æ˜¯æŠŠè¾ƒå°çš„å°ç»„æŒ‚åœ¨è¾ƒå¤§çš„å°ç»„ä¸Šï¼Œé¿å…æ ‘å˜å¾—å¤ªæ·±ã€‚
- **ä¾‹å­**ï¼šAå°ç»„æœ‰10äººï¼ŒBå°ç»„æœ‰5äººã€‚åˆå¹¶æ—¶ï¼ŒæŠŠBå°ç»„çš„ç»„é•¿å˜æˆAå°ç»„çš„ç»„é•¿ï¼Œè¿™æ ·æ ‘çš„ç»“æ„æ›´å¹³è¡¡ã€‚

---

### **å¹¶æŸ¥é›†çš„ä»£ç å®ç°**

æˆ‘ä»¬ç”¨ Python æ¥å†™ä¸€ä¸ªç®€å•çš„å¹¶æŸ¥é›†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
class UnionFind:
    def __init__(self, n):
        # åˆå§‹åŒ–ï¼šæ¯ä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹æ˜¯è‡ªå·±ï¼ˆåˆå§‹æ—¶æ¯ä¸ªäººéƒ½æ˜¯è‡ªå·±çš„ç»„é•¿ï¼‰
        self.parent = list(range(n))
        # ç§©ï¼ˆæ ‘çš„é«˜åº¦ï¼‰ï¼Œåˆå§‹æ—¶æ¯ä¸ªå°ç»„åªæœ‰è‡ªå·±
        self.rank = [1] * n

    def find(self, x):
        # æŸ¥æ‰¾xçš„ç»„é•¿ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼Œå¹¶è¿›è¡Œè·¯å¾„å‹ç¼©
        if self.parent[x] != x:
            self.parent[x] = self.find(self.parent[x])  # é€’å½’æŸ¥æ‰¾ï¼Œå¹¶æ›´æ–°çˆ¶èŠ‚ç‚¹
        return self.parent[x]

    def union(self, x, y):
        # åˆå¹¶xå’Œyæ‰€åœ¨çš„å°ç»„
        root_x = self.find(x)
        root_y = self.find(y)

        if root_x == root_y:
            return  # å·²ç»æ˜¯åŒä¸€ä¸ªå°ç»„ï¼Œæ— éœ€åˆå¹¶

        # æŒ‰ç§©åˆå¹¶ï¼šå°†è¾ƒå°çš„æ ‘åˆå¹¶åˆ°è¾ƒå¤§çš„æ ‘ä¸Š
        if self.rank[root_x] > self.rank[root_y]:
            self.parent[root_y] = root_x
        elif self.rank[root_x] < self.rank[root_y]:
            self.parent[root_x] = root_y
        else:
            # å¦‚æœä¸¤æ£µæ ‘é«˜åº¦ç›¸åŒï¼Œåˆå¹¶åé«˜åº¦åŠ 1
            self.parent[root_y] = root_x
            self.rank[root_x] += 1
```

---

### **å¹¶æŸ¥é›†çš„å®é™…åº”ç”¨**

#### **1. æœ‹å‹åœˆé—®é¢˜**

- **åœºæ™¯**ï¼šç»™å®šä¸€ç»„å¥½å‹å…³ç³»ï¼Œè®¡ç®—æœ‹å‹åœˆçš„æ•°é‡ã€‚
- **ä¾‹å­**ï¼šå‡è®¾æœ‰ 5 ä¸ªäººï¼Œåˆå§‹æ—¶æ¯ä¸ªäººéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚  
  å¦‚æœ 0 å’Œ 1 æˆä¸ºæœ‹å‹ï¼Œ2 å’Œ 3 æˆä¸ºæœ‹å‹ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šæœ‰ 3 ä¸ªæœ‹å‹åœˆï¼ˆ0-1ã€2-3ã€4ï¼‰ã€‚

```python
uf = UnionFind(5)
uf.union(0, 1)  # 0 å’Œ 1 æˆä¸ºæœ‹å‹
uf.union(2, 3)  # 2 å’Œ 3 æˆä¸ºæœ‹å‹

# ç»Ÿè®¡æ ¹èŠ‚ç‚¹çš„æ•°é‡ï¼ˆå³æœ‹å‹åœˆçš„æ•°é‡ï¼‰
roots = set(uf.find(i) for i in range(5))
print("æœ‹å‹åœˆæ•°é‡:", len(roots))  # è¾“å‡º: 3
```

#### **2. ç½‘ç»œè¿é€šæ€§é—®é¢˜**

- **åœºæ™¯**ï¼šåˆ¤æ–­ç½‘ç»œä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦è¿é€šã€‚
- **ä¾‹å­**ï¼šå‡è®¾æœ‰ä¸€ä¸ªç¤¾äº¤ç½‘ç»œï¼Œåˆ¤æ–­ä¸¤ä¸ªäººæ˜¯å¦é€šè¿‡æœ‹å‹å…³ç³»é—´æ¥è®¤è¯†ã€‚

```python
uf = UnionFind(5)
uf.union(0, 1)  # 0 å’Œ 1 æ˜¯æœ‹å‹
uf.union(1, 2)  # 1 å’Œ 2 æ˜¯æœ‹å‹

# åˆ¤æ–­ 0 å’Œ 2 æ˜¯å¦è¿é€š
if uf.find(0) == uf.find(2):
    print("0 å’Œ 2 æ˜¯è¿é€šçš„ï¼")
else:
    print("0 å’Œ 2 ä¸è¿é€šã€‚")
```

---

### **æ€»ç»“**

- **å¹¶æŸ¥é›†**å°±åƒä¸€ä¸ªâ€œæœ‹å‹åœˆç®¡ç†å™¨â€ï¼Œèƒ½å¿«é€Ÿåˆ¤æ–­ä¸¤ä¸ªäººæ˜¯å¦åœ¨åŒä¸€ä¸ªç»„ï¼Œæˆ–è€…åˆå¹¶ä¸¤ä¸ªç»„ã€‚
- å®ƒçš„æ ¸å¿ƒæ˜¯ **æŸ¥æ‰¾ï¼ˆFindï¼‰** å’Œ **åˆå¹¶ï¼ˆUnionï¼‰**ï¼Œé€šè¿‡ **è·¯å¾„å‹ç¼©** å’Œ **æŒ‰ç§©åˆå¹¶** æ¥æé«˜æ•ˆç‡ã€‚
- é€‚ç”¨äºè§£å†³ **è¿é€šæ€§é—®é¢˜**ï¼ˆæ¯”å¦‚ç¤¾äº¤ç½‘ç»œã€å²›å±¿æ•°é‡ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ã€‚

å¦‚æœä½ è§‰å¾—è¿™ä¸ªè§£é‡Šè¿˜ä¸å¤Ÿç®€å•ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šç”¨æ›´ç”Ÿæ´»åŒ–çš„ä¾‹å­æ¥è§£é‡Šï¼ ğŸ˜Š

### **åˆ›å»ºä¸€ä¸ªå­—å…¸**

ä½ å¯ä»¥ç”¨èŠ±æ‹¬å· `{}` åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸æˆ–ä¸€ä¸ªåŒ…å«é”®å€¼å¯¹çš„å­—å…¸ã€‚é”®å’Œå€¼ä¹‹é—´ä½¿ç”¨å†’å· `:` åˆ†éš”ï¼Œä¸åŒçš„é”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨é€—å·
`,` åˆ†éš”ã€‚

```python
# åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸
empty_dict = {}

# åˆ›å»ºä¸€ä¸ªæœ‰å†…å®¹çš„å­—å…¸
person = {
    "name": "Alice",
    "age": 30,
    "is_student": False
}
```

### 3. **è®¿é—®å’Œä¿®æ”¹å­—å…¸**

é€šè¿‡é”®å¯ä»¥è®¿é—®å­—å…¸ä¸­å¯¹åº”çš„å€¼ã€‚

```python
# è®¿é—®åå­—
print(person["name"])  # è¾“å‡º: Alice

# ä¿®æ”¹å¹´é¾„
person["age"] = 31
```

### 4. **æ·»åŠ å’Œåˆ é™¤å…ƒç´ **

- **æ·»åŠ **ï¼šåªéœ€èµ‹å€¼ä¸€ä¸ªæ–°é”®å³å¯ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨è¢«æ·»åŠ ã€‚
- **åˆ é™¤**ï¼šå¯ä»¥ä½¿ç”¨ `del` å‘½ä»¤æ¥ç§»é™¤æŸä¸ªé”®åŠå…¶å¯¹åº”çš„å€¼ã€‚

```python
# æ·»åŠ åœ°å€å­—æ®µ
person["address"] = "123 Python Street"

# åˆ é™¤is_studentå­—æ®µ
del person["is_student"]
```

### 5. **å­—å…¸çš„å†…ç½®å‡½æ•°å’Œæ–¹æ³•**

- `len(dict)`ï¼šè¿”å›å­—å…¸åŒ…å«å¤šå°‘é”®å€¼å¯¹ã€‚
- `dict.keys()`ï¼šè¿”å›æ‰€æœ‰é”®ç»„æˆçš„è§†å›¾å¯¹è±¡ï¼ˆå¯ä»¥é€šè¿‡`list()`è½¬æ¢ä¸ºåˆ—è¡¨ï¼‰ã€‚
- `dict.values()`ï¼šè¿”å›æ‰€æœ‰å€¼ç»„æˆçš„è§†å›¾å¯¹è±¡ã€‚
- `dict.items()`ï¼šè¿”å›æ‰€æœ‰é”®å€¼å¯¹ç»„æˆçš„è§†å›¾å¯¹è±¡ã€‚

```python
# é•¿åº¦
print(len(person))  # è¾“å‡º: 3

# æ‰€æœ‰é”®
print(list(person.keys()))  # ['name', 'age', 'address']

# æ‰€æœ‰å€¼
print(list(person.values()))  # ['Alice', 31, '123 Python Street']

# æ‰€æœ‰é”®å€¼å¯¹
print(list(person.items()))  # [('name', 'Alice'), ('age', 31), ('address', '123 Python Street')]
```

### 6. **å­—å…¸éå†**

ä½ å¯ä»¥é€šè¿‡ `for` å¾ªç¯æ¥è¿­ä»£å­—å…¸çš„é”®ã€å€¼æˆ–è€…é”®å€¼å¯¹ã€‚

```python
# è¿­ä»£æ‰€æœ‰é”®
for key in person.keys():
    print(key)

# è¿­ä»£æ‰€æœ‰å€¼
for value in person.values():
    print(value)

# è¿­ä»£æ‰€æœ‰é”®å€¼å¯¹
for key, value in person.items():
    print(f"{key}: {value}")
```

### 7. **å°ç»“**

å­—å…¸æ˜¯ä¸€ç§éå¸¸çµæ´»ä¸”å¼ºå¤§çš„æ•°æ®ç±»å‹ï¼Œé€‚åˆç”¨æ¥å­˜å‚¨å’Œç»„ç»‡å…³è”æ€§è¾ƒå¼ºçš„æ•°æ®ã€‚å®ƒä»¬é€šè¿‡é”®å¿«é€Ÿè®¿é—®ã€ä¿®æ”¹å’Œç®¡ç†å€¼ï¼Œå¯ä»¥æå¤§åœ°
æé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ•ˆç‡ã€‚

### 1. **åŸºæœ¬æ¦‚å¿µ**

`defaultdict` å’Œæ™®é€šå­—å…¸éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šå½“ä½ è¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨äº `defaultdict` ä¸­çš„é”®æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªé”®
ï¼Œå¹¶ä½¿ç”¨æä¾›çš„é»˜è®¤å€¼åˆå§‹åŒ–ã€‚ä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯å‡½æ•°ï¼‰æ¥å®šä¹‰è¿™ä¸ªé»˜è®¤å€¼ã€‚

### 2. **ä¸ºä»€ä¹ˆè¦ç”¨ `defaultdict`ï¼Ÿ**

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿å­—å…¸ä¸­æ‰€æœ‰çš„é”®éƒ½æœ‰åˆå§‹å€¼ã€‚ä½¿ç”¨æ™®é€šå­—å…¸æ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨æ£€æŸ¥å’Œè®¾ç½®è¿™ä¸ªé»˜è®¤å€¼ï¼Œè€Œ
`defaultdict` å¯ä»¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚

### 3. **å¦‚ä½•åˆ›å»ºä¸€ä¸ª `defaultdict`ï¼Ÿ**

é¦–å…ˆï¼Œè¦å¯¼å…¥ `collections` æ¨¡å—å¹¶ä½¿ç”¨å®ƒä¸­çš„ `defaultdict` ç±»ã€‚ç„¶åä½ å¯ä»¥æŒ‡å®šé»˜è®¤å€¼ç±»å‹æˆ–æä¾›ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆé»˜è®¤å€¼ã€‚

```python
from collections import defaultdict

# ä½¿ç”¨ int ä½œä¸ºé»˜è®¤å€¼å·¥å‚ï¼Œè¿™æ„å‘³ç€ä»»ä½•æ–°é”®éƒ½å°†è¢«åˆå§‹åŒ–ä¸º0ã€‚
count = defaultdict(int)

# è®¿é—®å¹¶å¢åŠ  'apple' é”®çš„å€¼
count['apple'] += 1
print(count)  # è¾“å‡º: defaultdict(<class 'int'>, {'apple': 1})

# è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é”®ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸º0ã€‚
print(count['banana'])  # è¾“å‡º: 0

# ç°åœ¨æˆ‘ä»¬åˆå¢åŠ äº†ä¸€æ¬¡ 'banana'
count['banana'] += 1
print(count)  # è¾“å‡º: defaultdict(<class 'int'>, {'apple': 1, 'banana': 1})
```

### 4. **ä¸åŒç±»å‹çš„é»˜è®¤å€¼**

`defaultdict` æ”¯æŒä»»ä½•å¯è°ƒç”¨å¯¹è±¡ä½œä¸ºå…¶å·¥å‚å‡½æ•°ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ `list`, `set`, æˆ–è€…è‡ªå®šä¹‰çš„å‡½æ•°ã€‚

```python
# ä½¿ç”¨ list ä½œä¸ºé»˜è®¤å€¼å·¥å‚
fruits = defaultdict(list)

# æ·»åŠ è‹¹æœçš„é¢œè‰²
fruits['apple'].append('red')
fruits['apple'].append('green')

print(fruits)  # è¾“å‡º: defaultdict(<class 'list'>, {'apple': ['red', 'green']})

# ä½¿ç”¨ set ä½œä¸ºé»˜è®¤å€¼å·¥å‚ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨å»é‡å¤
unique_fruits = defaultdict(set)
unique_fruits['basket'].add('apple')
unique_fruits['basket'].add('banana')
unique_fruits['basket'].add('apple')  # è¿™ä¸ªä¸ä¼šè¢«å†æ¬¡æ·»åŠ 

print(unique_fruits)  # è¾“å‡º: defaultdict(<class 'set'>, {'basket': {'apple', 'banana'}})

# è‡ªå®šä¹‰çš„é»˜è®¤å€¼å·¥å‚
def default_factory():
    return "unknown"

names = defaultdict(default_factory)
print(names['first_name'])  # è¾“å‡º: unknown
```

### 5. **æ³¨æ„äº‹é¡¹**

- `defaultdict` çš„é»˜è®¤å·¥å‚å‡½æ•°åªä¼šåœ¨è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹åå¯¹è¯¥é”®è¿›è¡Œæ“ä½œæ—¶ä¸ä¼šå†è¢«è°ƒç”¨ã€‚
- ä½¿ç”¨ `defaultdict` å¯ä»¥ç®€åŒ–ä»£ç é€»è¾‘ï¼Œä½†è¯·ç¡®ä¿è¿™ç¬¦åˆä½ çš„éœ€æ±‚ã€‚æœ‰æ—¶å€™ï¼Œæ˜ç¡®æ£€æŸ¥å’Œåˆå§‹åŒ–é”®å€¼å¯¹å¯èƒ½æ›´åŠ é€æ˜ã€‚

### 6. **å°ç»“**

`collections.defaultdict` æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­è‡ªåŠ¨å¤„ç†å­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®ã€‚é€šè¿‡è®¾ç½®åˆé€‚çš„é»˜è®¤å€¼ç”Ÿ
æˆå™¨ï¼ˆå·¥å‚å‡½æ•°ï¼‰ï¼Œä½ å¯ä»¥å‡å°‘æ£€æŸ¥å’Œåˆå§‹åŒ–ä»£ç çš„å¤æ‚æ€§ã€‚

å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ ç†è§£ `defaultdict` çš„ç”¨æ³•ï¼å¦‚æœæœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦è¿›ä¸€æ­¥æ¢è®¨ï¼Œè¯·éšæ—¶æé—®ã€‚

å½“ç„¶å¯ä»¥ï¼åœ¨ Python ä¸­ï¼Œ`Counter` æ˜¯ `collections` æ¨¡å—ä¸­çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç±»ã€‚å®ƒå…è®¸ä½ å¿«é€Ÿç»Ÿè®¡å¯å“ˆå¸Œå¯¹è±¡ï¼ˆå¦‚å­—ç¬¦ä¸²ã€
å­—ç¬¦ï¼‰å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥å­—å…¸çš„å½¢å¼å­˜å‚¨è¿™äº›è®¡æ•°ã€‚`Counter` ç±»ç»§æ‰¿è‡ª `dict`ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åƒå¸¸è§„å­—å…¸ä¸€æ ·ä½¿ç”¨ã€‚

### åŸºæœ¬ç”¨æ³•

1. **åˆ›å»ºä¸€ä¸ª Counter**:
   ä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªåºåˆ—ï¼ˆå¦‚åˆ—è¡¨ã€å­—ç¬¦ä¸²ï¼‰æˆ–è€…ä¸€ä¸ªå­—å…¸æ¥åˆ›å»ºä¸€ä¸ª `Counter` å¯¹è±¡ã€‚å¦‚æœæ˜¯åºåˆ—ï¼Œå®ƒå°†ç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„å‡ºç°
   æ¬¡æ•°ï¼›å¦‚æœæ˜¯å­—å…¸ï¼Œå®ƒä¼šå°†é”®è§†ä¸ºå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å€¼ä½œä¸ºè¿™äº›å¯¹è±¡çš„è®¡æ•°ã€‚

   ```python
   from collections import Counter
   
   # é€šè¿‡åˆ—è¡¨åˆ›å»º
   word_count = Counter(['apple', 'banana', 'apple', 'orange', 'banana', 'banana'])
   print(word_count)  # è¾“å‡º: Counter({'banana': 3, 'apple': 2, 'orange': 1})
   
   # é€šè¿‡å­—ç¬¦ä¸²åˆ›å»º
   char_count = Counter('hello world')
   print(char_count)  # è¾“å‡º: Counter({'l': 3, 'o': 2, 'h': 1, 'e': 1, ' ': 1, 'w': 1, 'r': 1, 'd': 1})
   
   # é€šè¿‡å­—å…¸åˆ›å»º
   fruit_count = Counter(apple=2, banana=3)
   print(fruit_count)  # è¾“å‡º: Counter({'banana': 3, 'apple': 2})
   ```

2. **è®¿é—®è®¡æ•°**:
   ä½ å¯ä»¥åƒè®¿é—®ä»»ä½•å­—å…¸ä¸€æ ·æ¥è·å–ç‰¹å®šå…ƒç´ çš„è®¡æ•°ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ æ²¡æœ‰å‡ºç°åœ¨ `Counter` ä¸­ï¼Œå®ƒå°†è¿”å› 0 è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ã€‚

   ```python
   print(word_count['apple'])    # è¾“å‡º: 2
   print(char_count['z'])        # è¾“å‡º: 0
   ```

3. **æ›´æ–°è®¡æ•°**:
   ä½¿ç”¨ `update` æ–¹æ³•å¯ä»¥ä»å¦ä¸€ä¸ªåºåˆ—æˆ–å­—å…¸ä¸­å¢åŠ è®¡æ•°ã€‚

   ```python
   word_count.update(['apple', 'orange'])
   print(word_count)  # è¾“å‡º: Counter({'banana': 3, 'apple': 3, 'orange': 2})
   ```

4. **å‡å°‘è®¡æ•°**:
   `subtract` æ–¹æ³•å¯ä»¥ä»å¦ä¸€ä¸ªåºåˆ—æˆ–å­—å…¸ä¸­å‡å°‘è®¡æ•°ã€‚

   ```python
   word_count.subtract(['apple', 'banana'])
   print(word_count)  # è¾“å‡º: Counter({'orange': 2, 'banana': 2, 'apple': 2})
   ```

5. **è·å–æœ€å¸¸è§çš„å…ƒç´ **:
   `most_common` æ–¹æ³•è¿”å›è®¡æ•°æœ€å¤šçš„å…ƒç´ ï¼Œå¯ä»¥é€‰æ‹©æä¾›ä¸€ä¸ªå‚æ•°æ¥é™åˆ¶æ•°é‡ã€‚

   ```python
   print(word_count.most_common(2))  # è¾“å‡º: [('orange', 2), ('banana', 2)]
   ```

6. **åˆå¹¶ Counters**:
   å¯ä»¥é€šè¿‡åŠ æ³•æ“ä½œç¬¦ `+` æ¥åˆå¹¶ä¸¤ä¸ª `Counter` å¯¹è±¡ã€‚

   ```python
   counter1 = Counter(a=3, b=1)
   counter2 = Counter(a=1, b=2)
   combined_counter = counter1 + counter2
   print(combined_counter)  # è¾“å‡º: Counter({'a': 4, 'b': 3})
   ```

7. **å·®å¼‚æ“ä½œ**:
   å¯ä»¥é€šè¿‡å‡æ³•æ“ä½œç¬¦ `-` æ¥è®¡ç®—ä¸¤ä¸ª `Counter` å¯¹è±¡çš„å·®ã€‚

   ```python
   difference = counter1 - counter2
   print(difference)  # è¾“å‡º: Counter({'a': 2})
   ```

å¥½çš„ï¼æˆ‘æ¥ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼ç»™ä½ è®²è®² **KMPç®—æ³•**ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ä¸­éå¸¸ç»å…¸çš„ä¸€ç§ï¼Œæ•ˆç‡å¾ˆ
é«˜ï¼

---

###### ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šå­—ç¬¦ä¸²åŒ¹é…
å‡è®¾æˆ‘ä»¬æœ‰ï¼š
- ä¸€ä¸ª**é•¿å­—ç¬¦ä¸²**ï¼ˆæ¯”å¦‚ "ABABCABABC"ï¼‰
- ä¸€ä¸ª**ç›®æ ‡å­ä¸²**ï¼ˆæ¯”å¦‚ "ABABC"ï¼‰

æˆ‘ä»¬è¦æ‰¾å‡ºï¼š**ç›®æ ‡å­ä¸²æ˜¯å¦å‡ºç°åœ¨é•¿å­—ç¬¦ä¸²ä¸­ï¼Ÿå‡ºç°çš„ä½ç½®æ˜¯å“ªé‡Œï¼Ÿ**

æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š**æš´åŠ›åŒ¹é…**ï¼ˆé€ä¸ªå­—ç¬¦æ¯”å¯¹ï¼‰ï¼Œä½†è¿™ç§æ–¹æ³•æ•ˆç‡ä¸é«˜ï¼ˆæ¯”å¦‚é‡å¤åŒ¹é…çš„éƒ¨åˆ†ä¼šåå¤æ¯”è¾ƒï¼‰ã€‚

---

###### äºŒã€KMPç®—æ³•çš„æ€è·¯ï¼šé¿å…é‡å¤æ¯”è¾ƒ
KMPçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åˆ©ç”¨ç›®æ ‡å­ä¸²æœ¬èº«çš„ç‰¹æ€§**ï¼Œæå‰çŸ¥é“åœ¨åŒ¹é…å¤±è´¥æ—¶åº”è¯¥è·³åˆ°å“ªé‡Œç»§ç»­æ¯”è¾ƒï¼Œä»è€Œé¿å…é‡å¤æ¯”è¾ƒã€‚

---

###### ä¸‰ã€KMPçš„å…³é”®ï¼š**éƒ¨åˆ†åŒ¹é…è¡¨**ï¼ˆä¹Ÿå«å‰ç¼€å‡½æ•°ï¼‰
###### 1. ä»€ä¹ˆæ˜¯éƒ¨åˆ†åŒ¹é…è¡¨ï¼Ÿ
å¯¹äºç›®æ ‡å­ä¸²ï¼ˆæ¯”å¦‚ "ABABC"ï¼‰ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä½ç½®è®¡ç®—ä¸€ä¸ªå€¼ï¼š**è¯¥ä½ç½®çš„æœ€é•¿å‰ç¼€å’Œåç¼€çš„åŒ¹é…é•¿åº¦**ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
å‡è®¾ç›®æ ‡å­ä¸²æ˜¯ `"ABAB"`ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä½ç½®è®¡ç®—ï¼š
- å­—ç¬¦ä¸² `"A"`ï¼šæœ€é•¿å‰ç¼€å’Œåç¼€æ˜¯ `"A"`ï¼Œé•¿åº¦æ˜¯ 1ï¼ˆä½†è¿™é‡Œæˆ‘ä»¬åªè®°å½• **ä¸åŒ…æ‹¬æ•´ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿åŒ¹é…**ï¼Œæ‰€ä»¥å®é™…æ˜¯ 0ï¼Ÿï¼‰

- å­—ç¬¦ä¸² `"AB"`ï¼šæœ€é•¿å‰ç¼€æ˜¯ `"A"`ï¼Œæœ€é•¿åç¼€æ˜¯ `"B"`ï¼Œæ²¡æœ‰åŒ¹é…ï¼Œæ‰€ä»¥æ˜¯ 0ã€‚
- å­—ç¬¦ä¸² `"ABA"`ï¼šæœ€é•¿å‰ç¼€å’Œåç¼€æ˜¯ `"A"`ï¼Œé•¿åº¦æ˜¯ 1ã€‚
- å­—ç¬¦ä¸² `"ABAB"`ï¼šæœ€é•¿å‰ç¼€å’Œåç¼€æ˜¯ `"AB"`ï¼Œé•¿åº¦æ˜¯ 2ã€‚

æ‰€ä»¥ï¼Œ**"ABAB"** çš„éƒ¨åˆ†åŒ¹é…è¡¨æ˜¯ï¼š`[0, 0, 1, 2]`

---

###### 2. ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¡¨ï¼Ÿ
å½“åŒ¹é…å¤±è´¥æ—¶ï¼ŒKMPä¼šåˆ©ç”¨è¿™ä¸ªè¡¨å‘Šè¯‰æˆ‘ä»¬è¦è·³åˆ°å“ªé‡Œç»§ç»­æ¯”è¾ƒï¼Œ**è€Œä¸æ˜¯å›é€€åˆ°æ–‡æœ¬ä¸²çš„èµ·å§‹ä½ç½®**ï¼Œä»è€ŒèŠ‚çœæ—¶é—´ã€‚

---

###### å››ã€KMPç®—æ³•çš„æ­¥éª¤
###### 1. æ„é€ éƒ¨åˆ†åŒ¹é…è¡¨ï¼ˆå‰ç¼€å‡½æ•°ï¼‰
ç”¨ä»£ç å®ç°çš„è¯ï¼š
```python
def compute_prefix(pattern):
    n = len(pattern)
    prefix = [0] * n
    j = 0
    for i in range(1, n):
        while j > 0 and pattern[i] != pattern[j]:
            j = prefix[j-1]
        if pattern[i] == pattern[j]:
            j += 1
            prefix[i] = j
        else:
            prefix[i] = 0
    return prefix
```

---

###### 2. ä½¿ç”¨éƒ¨åˆ†åŒ¹é…è¡¨è¿›è¡ŒåŒ¹é…
å‡è®¾æˆ‘ä»¬æœ‰ï¼š
- æ–‡æœ¬ä¸²ï¼š`text = "ABABCABABC"`
- ç›®æ ‡å­ä¸²ï¼š`pattern = "ABABC"`

æ„é€ å¥½éƒ¨åˆ†åŒ¹é…è¡¨åï¼ˆæ¯”å¦‚ `[0, 0, 1, 2, 0]`ï¼‰ï¼Œå¼€å§‹åŒ¹é…ã€‚

###### åŒ¹é…è¿‡ç¨‹ï¼ˆä¼ªä»£ç ï¼‰ï¼š
```python
def kmp_search(text, pattern, prefix):
    j = 0  # patternçš„æŒ‡é’ˆ
    for i in range(len(text)):
        while j > 0 and text[i] != pattern[j]:
            j = prefix[j-1]
        if text[i] == pattern[j]:
            j += 1
        if j == len(pattern):
            return i - len(pattern) + 1  # æ‰¾åˆ°åŒ¹é…ä½ç½®
    return -1  # æœªæ‰¾åˆ°
```

---

###### äº”ã€ä¸¾ä¸ªä¾‹å­
å‡è®¾æˆ‘ä»¬è¦åœ¨ `"ABCABCDABABCABCDAB"` ä¸­æ‰¾ `"ABCDAB"`ã€‚

1. æ„é€ éƒ¨åˆ†åŒ¹é…è¡¨ï¼š
   - `"ABCDAB"` çš„éƒ¨åˆ†åŒ¹é…è¡¨æ˜¯ `[0, 0, 0, 0, 1, 0]`

2. åŒ¹é…è¿‡ç¨‹ï¼š
   - å½“åŒ¹é…åˆ°æŸä¸ªä½ç½®å¤±è´¥æ—¶ï¼Œé€šè¿‡è¡¨è°ƒæ•´ `pattern` çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯å›é€€ `text` çš„æŒ‡é’ˆã€‚

---

###### å…­ã€KMPçš„æ•ˆç‡
- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n + m)`ï¼Œå…¶ä¸­ `n` æ˜¯æ–‡æœ¬é•¿åº¦ï¼Œ`m` æ˜¯æ¨¡å¼ä¸²é•¿åº¦ã€‚
- **ä¼˜ç‚¹**ï¼šæ¯”æš´åŠ›æ³•ï¼ˆ`O(nm)`ï¼‰å¿«å¾—å¤šï¼

---

###### ä¸ƒã€Pythonä»£ç ç¤ºä¾‹
```python
def kmp_search(text, pattern):
    # æ­¥éª¤1ï¼šæ„é€ éƒ¨åˆ†åŒ¹é…è¡¨
    prefix = compute_prefix(pattern)
    # æ­¥éª¤2ï¼šä½¿ç”¨KMPç®—æ³•æŸ¥æ‰¾
    j = 0
    for i in range(len(text)):
        while j > 0 and text[i] != pattern[j]:
            j = prefix[j-1]
        if text[i] == pattern[j]:
            j += 1
        if j == len(pattern):
            print(f"æ‰¾åˆ°åŒ¹é…ï¼Œä½ç½®æ˜¯: {i - len(pattern) + 1}")
            return
    print("æœªæ‰¾åˆ°åŒ¹é…")

# ç¤ºä¾‹
text = "ABABCABABC"
pattern = "ABABC"
kmp_search(text, pattern)
```

---

###### å…«ã€æ€»ç»“
| æ¦‚å¿µ         | è¯´æ˜                                 |
| ------------ | ------------------------------------ |
| **æš´åŠ›åŒ¹é…** | æ¯æ¬¡åŒ¹é…å¤±è´¥éƒ½å›é€€åˆ°æ–‡æœ¬ä¸²çš„èµ·å§‹ä½ç½® |
| **KMPç®—æ³•**  | é€šè¿‡**éƒ¨åˆ†åŒ¹é…è¡¨**é¿å…å›é€€ï¼Œæé«˜æ•ˆç‡ |
| **å…³é”®ç‚¹**   | æ„é€ éƒ¨åˆ†åŒ¹é…è¡¨ï¼Œåˆ©ç”¨å·²çŸ¥çš„æ¨¡å¼ä¸²ä¿¡æ¯ |